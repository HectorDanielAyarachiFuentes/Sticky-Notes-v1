<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Productividad | Impulsa tu Enfoque</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
     <!-- Icono (Favicon) - Un cohete de productividad 🚀 -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%235a7dcb' d='M83.2,16.8C75.1,8.7,66.2,2,50,2S24.9,8.7,16.8,16.8C8.7,24.9,2,33.8,2,50s6.7,25.1,14.8,33.2 c8.1,8.1,17,14.8,33.2,14.8s25.1-6.7,33.2-14.8C91.3,75.1,98,66.2,98,50S91.3,24.9,83.2,16.8z M72.2,38.1L57.5,52.8 c-2.5,2.5-5.8,3.7-9.2,3.7s-6.7-1.2-9.2-3.7L24.5,38.1c-1-1-1.5-2.2-1.5-3.5s0.5-2.5,1.5-3.5c2-2,5.1-2,7.1,0l12.4,12.4V22.2 c0-2.8,2.3-5.1,5.1-5.1s5.1,2.3,5.1,5.1v21.3l12.4-12.4c2-2,5.1-2,7.1,0C74.2,33,74.2,36.1,72.2,38.1z M68.5,75.7 c0,1.4-0.5,2.7-1.5,3.7c-2,2-5.1,2-7.1,0L50,69.5l-9.9,9.9c-2,2-5.1,2-7.1,0c-1-1-1.5-2.3-1.5-3.7c0-1.4,0.5-2.7,1.5-3.7L43,62.1 c2.5-2.5,5.8-3.7,9.2-3.7s6.7,1.2,9.2,3.7l9.9,9.9C68,73,68.5,74.3,68.5,75.7z'%3E%3C/path%3E%3C/svg%3E" type="image/svg+xml">
    
    <!-- Metadatos Esenciales y SEO -->
    <meta name="description" content="Organiza tus tareas, gestiona tu tiempo y aumenta tu enfoque con este dashboard de productividad personal. Incluye notas, zonas de trabajo, temporizador y más.">
    <meta name="author" content="Hector Daniel Ayarachi Fuentes">
    <meta name="theme-color" content="#5a7dcb"> 

    <!-- Metadatos de Open Graph para Redes Sociales -->
    <meta property="og:title" content="Dashboard de Productividad | Impulsa tu Enfoque">
    <meta property="og:description" content="Organiza tus tareas, gestiona tu tiempo y aumenta tu enfoque con este dashboard de productividad personal.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hectordanielayarachifuentes.github.io/Sticky-Notes-v1/">
    <meta property="og:image" content="https://hectordanielayarachifuentes.github.io/Sticky-Notes-v1/img/luna.jpg"> 

    <!-- Metadatos para Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Dashboard de Productividad | Impulsa tu Enfoque">
    <meta name="twitter:description" content="Organiza tus tareas, gestiona tu tiempo y aumenta tu enfoque con este dashboard de productividad personal.">
    <meta name="twitter:image" content="https://hectordanielayarachifuentes.github.io/Sticky-Notes-v1/img/luna.jpg">
    
    <style>
        :root {
            --bg-color: #f4f7f9;
            --note-color: #fffde7;
            --note-shadow: rgba(0, 0, 0, 0.1);
            --primary-accent: #5a7dcb;
            --primary-accent-dark: #405b9b;
            --panel-bg: rgba(255, 255, 255, 0.6);
            --panel-border: rgba(255, 255, 255, 0.8);
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --zone-bg: rgba(90, 125, 203, 0.1);
            --zone-border: rgba(90, 125, 203, 0.4);
            --highlight-color: #ffc107;
            --danger-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
            100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23dce3eb" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            margin: 0; padding: 0; overflow: hidden; height: 100vh;
        }
        #google-signin-btn { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 15px 30px; font-size: 18px; font-weight: 600; color: white; background-color: #DB4437; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 10000; }
        .logged-in #google-signin-btn { display: none; }
        .logged-out .main-content { display: none; }
        .main-content { opacity: 0; transition: opacity 0.5s ease-in-out; }
        .logged-in .main-content { opacity: 1; }
        #app { position: relative; width: 100%; height: calc(100vh - 140px); padding: 20px; padding-top: 70px; box-sizing: border-box; }
        #workspace-title { position: fixed; top: 20px; left: 20px; font-size: 24px; font-weight: 600; color: var(--text-dark); z-index: 1001; }
        #top-controls { position: fixed; top: 15px; right: 20px; z-index: 1001; display: flex; gap: 12px; align-items: center; }
        #save-status { font-size: 14px; color: var(--text-light); transition: opacity 0.3s ease; margin-right: 10px; }
        .control-btn { padding: 10px 22px; font-size: 14px; font-weight: 600; color: white; background-color: var(--primary-accent); border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 15px rgba(90, 125, 203, 0.3); transition: all 0.3s ease; }
        .control-btn:hover { background-color: var(--primary-accent-dark); transform: translateY(-2px); }
        .control-btn.secondary { background-color: #95a5a6; }
        .control-btn.secondary:hover { background-color: #7f8c8d; }
        .profile-menu-container { position: relative; }
        .profile-avatar { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; border: 2px solid var(--panel-border); box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s ease; }
        .profile-avatar:hover { transform: scale(1.05); }
        .profile-dropdown { position: absolute; top: 120%; right: 0; width: 220px; background-color: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); padding: 15px; box-sizing: border-box; opacity: 0; visibility: hidden; transform: translateY(10px); transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); z-index: 1005; }
        .profile-menu-container:hover .profile-dropdown { opacity: 1; visibility: visible; transform: translateY(0); }
        .profile-dropdown .user-info { text-align: center; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0; margin-bottom: 10px; }
        .profile-dropdown .user-name { font-weight: 600; color: var(--text-dark); margin: 0; font-size: 16px; }
        .profile-dropdown .signout-btn { width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px; border: none; background-color: transparent; font-size: 14px; font-weight: 500; color: var(--danger-color); border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease; }
        .profile-dropdown .signout-btn:hover { background-color: #fef2f2; }
        .draggable { position: absolute; z-index: 10; }
        .dragging { z-index: 999 !important; }
        .note { width: 240px; height: 240px; background-color: var(--note-color); box-shadow: 0 8px 25px var(--note-shadow); border-radius: 8px; padding: 15px; box-sizing: border-box; cursor: move; display: flex; flex-direction: column; }
        .note textarea { flex-grow: 1; border: none; background: transparent; resize: none; font-family: 'Caveat', cursive; font-size: 22px; line-height: 1.5; color: var(--text-dark); outline: none; cursor: text; margin-top: 15px; }
        .zone { background-color: var(--zone-bg); backdrop-filter: blur(5px); border: 1px solid var(--zone-border); border-radius: 12px; box-sizing: border-box; cursor: move; z-index: 1; padding: 45px 15px 15px 15px; min-width: 250px; min-height: 200px; }
        .zone-title { position: absolute; top: 12px; left: 15px; font-weight: 600; font-size: 16px; color: var(--primary-accent-dark); border: none; background: transparent; width: calc(100% - 60px); outline: none; }
        .delete-btn { position: absolute; top: 8px; right: 8px; width: 24px; height: 24px; text-align: center; line-height: 24px; font-size: 20px; border-radius: 50%; cursor: pointer; user-select: none; transition: background-color 0.2s, color 0.2s; color: var(--text-light); }
        .delete-btn:hover { background-color: var(--highlight-color); color: white; }
        .resize-handle { position: absolute; bottom: 0; right: 0; width: 20px; height: 20px; cursor: nwse-resize; z-index: 11; }
        .resize-handle::after { content: ''; position: absolute; right: 5px; bottom: 5px; width: 8px; height: 8px; border-bottom: 2px solid var(--primary-accent); border-right: 2px solid var(--primary-accent); opacity: 0.5; }
        #bottom-dashboard { position: fixed; bottom: 0; left: 0; width: 100%; height: 140px; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(10px); border-top: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.05); display: flex; align-items: stretch; justify-content: space-between; padding: 0 15px; box-sizing: border-box; z-index: 1002; }
        .dashboard-widget { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-dark); padding: 10px; text-align: center; border-right: 1px solid rgba(0,0,0,0.05); flex-grow: 1; flex-basis: 0; }
        .dashboard-widget:last-child { border-right: none; }
        .dashboard-widget h3 { margin: 0 0 10px 0; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-light); letter-spacing: 0.5px; }
        #stats-widget span { font-size: 36px; font-weight: 600; }
        #clock-widget #current-time { font-size: 36px; font-weight: 600; }
        #clock-widget #current-date { font-size: 14px; color: var(--text-light); }
        #youtube-widget input { border: 1px solid #ccc; border-radius: 4px; padding: 6px 8px; width: 180px; font-size: 12px; margin-bottom: 8px; text-align: center; }
        #youtube-player { width: 150px; height: 60px; background: #eee; border-radius: 4px; overflow: hidden; }
        #youtube-player iframe { width: 100%; height: 100%; border: none; }
        #calendar-widget { min-width: 280px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 8px; }
        .calendar-header button { background: none; border: none; cursor: pointer; font-size: 18px; color: var(--primary-accent); }
        #month-year { font-size: 14px; font-weight: 600; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; width: 100%; }
        .calendar-grid span { text-align: center; padding: 2px; font-size: 12px; position: relative; }
        .day-name { font-weight: 600; color: var(--text-light); }
        .day { cursor: pointer; border-radius: 50%; transition: background-color 0.2s; }
        .day:hover { background-color: #e0e0e0; }
        .day.current-day { background-color: var(--highlight-color); color: white; font-weight: 600; }
        .day.selected-day { box-shadow: 0 0 0 2px var(--primary-accent); }
        .day.has-notes::after { content: ''; position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; background-color: var(--primary-accent); border-radius: 50%; }
        .timer-display-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 8px; }
        #timer-display { font-size: 32px; font-weight: 600; font-family: 'Poppins', monospace; letter-spacing: 2px; color: var(--text-dark); transition: color 0.4s ease, text-shadow 0.4s ease; padding: 5px; border-radius: 8px; }
        #timer-display.timer-running { color: var(--success-color); animation: pulse-green 2s infinite; }
        #timer-display.timer-paused { color: var(--warning-color); }
        #edit-timer-btn { background: none; border: none; cursor: pointer; font-size: 18px; color: var(--text-light); padding: 5px; border-radius: 50%; transition: background-color 0.2s; }
        #edit-timer-btn:hover { background-color: #e0e0e0; }
        #timer-widget .timer-buttons button { margin: 0 4px; padding: 5px 10px; font-size: 14px; cursor: pointer; border: 1px solid #ccc; border-radius: 4px; background: #fff; }
        #timer-widget .timer-buttons .hidden { display: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 9999; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .modal-content { background-color: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); text-align: center; max-width: 90%; width: 450px; transform: scale(0.9); transition: transform 0.3s ease; }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-content h2 { margin-top: 0; color: var(--text-dark); font-size: 28px; }
        .modal-content p { font-size: 16px; color: var(--text-light); margin-bottom: 25px; }
        .modal-content .action-btn { padding: 12px 30px; font-size: 16px; font-weight: 600; color: white; background-color: var(--primary-accent); border: none; border-radius: 50px; cursor: pointer; transition: background-color 0.2s; }
        .modal-content .action-btn:hover { background-color: var(--primary-accent-dark); }
        .set-timer-inputs { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
        .set-timer-inputs input { width: 70px; padding: 10px; font-size: 24px; text-align: center; border: 1px solid #ccc; border-radius: 8px; font-weight: 600; }
        .set-timer-inputs input::-webkit-outer-spin-button, .set-timer-inputs input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .set-timer-inputs input[type=number] { -moz-appearance: textfield; }
        .modal-actions { display: flex; justify-content: center; gap: 15px; }
        .modal-actions .confirm-btn { background-color: var(--primary-accent); color: white; }
        .modal-actions .confirm-btn:hover { background-color: var(--primary-accent-dark); }
        .modal-actions .cancel-btn { background-color: #ecf0f1; color: var(--text-dark); }
        .modal-actions .cancel-btn:hover { background-color: #bdc3c7; }

        /* ======================================= */
        /* === NUEVOS ESTILOS BASE PARA MÓVIL === */
        /* ======================================= */
        #sidebar-toggle-btn { display: none; padding: 8px 12px; font-size: 18px; line-height: 1; }
        #mobile-sidebar-container { display: none; }

        /* ============================================= */
        /* === CSS RESPONSIVO PARA MÓVIL (HASTA 768px) === */
        /* ============================================= */
        @media (max-width: 768px) {
            body { overflow-y: auto; overflow-x: hidden; height: auto; }
            body.sidebar-active { overflow: hidden; }
            #bottom-dashboard { display: none !important; }
            #sidebar-toggle-btn { display: block; }
            #mobile-sidebar-container { display: block; }
            
            #top-controls { padding: 0 10px; width: auto; right: 10px; }
            .control-btn.secondary, #addZoneBtn, #addNoteBtn { display: none; }
            
            #workspace-title {
                left: 60px;
                top: 21px;
                font-size: 16px;
                max-width: calc(100% - 120px);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .sidebar-overlay {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0, 0, 0, 0.5); z-index: 1099;
                opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
            }
            #mobile-sidebar {
                position: fixed; top: 0; left: -300px; width: 300px;
                max-width: 85%; height: 100%; background: #ffffff;
                z-index: 1100; box-shadow: 5px 0 15px rgba(0,0,0,0.1);
                transition: left 0.3s cubic-bezier(0.16, 1, 0.3, 1);
                display: flex; flex-direction: column;
            }
            body.sidebar-active .sidebar-overlay { opacity: 1; visibility: visible; }
            body.sidebar-active #mobile-sidebar { left: 0; }
            
            .sidebar-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #e0e0e0; }
            .sidebar-header h3 { margin: 0; font-size: 18px; color: var(--text-dark); }
            #close-sidebar-btn { background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-light); padding: 0 5px; }
            .sidebar-content { overflow-y: auto; flex-grow: 1; }
            
            .sidebar-content .dashboard-widget {
                flex-direction: column; align-items: flex-start; text-align: left;
                padding: 20px; border-right: none; border-bottom: 1px solid #eee;
            }
             .sidebar-content .dashboard-widget:last-child { border-bottom: none; }
             .sidebar-content .dashboard-widget h3 { margin-bottom: 15px; }
             .sidebar-content #stats-widget span, 
             .sidebar-content #clock-widget #current-time,
             .sidebar-content #timer-display { font-size: 28px; }
            .sidebar-content .timer-display-container { justify-content: flex-start;}
            .sidebar-content #youtube-widget input { width: calc(100% - 16px); }
            .sidebar-content #youtube-player { width: 100%; height: 120px; }
            .sidebar-content .calendar-header { padding: 0 5px; }
            .sidebar-content .calendar-grid { gap: 1px; }
             .sidebar-content .day { padding: 4px 0; }

            #app {
                display: flex; flex-direction: column; gap: 16px;
                padding: 80px 15px 20px 15px; height: auto;
            }
            #notesContainer, #zonesContainer { position: static; display: flex; flex-direction: column; gap: 16px; }
            .draggable, .note, .zone {
                position: static !important;
                left: auto !important; top: auto !important;
                width: 100% !important; height: auto !important;
                min-height: 150px; transform: none !important;
                cursor: default !important; box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            }
            .zone { padding-top: 55px; }
            .resize-handle { display: none !important; }
            .note textarea { min-height: 120px; font-size: 18px; }

            .modal-content { padding: 25px 20px; width: 90%; }
            .modal-content h2 { font-size: 22px; }
            .modal-content p { font-size: 14px; }
            .set-timer-inputs input { width: 50px; padding: 8px; font-size: 20px; }
        }
    </style>
</head>
<body class="logged-out">

    <button id="google-signin-btn">🚀 Iniciar Sesión con Google</button>

    <div class="main-content">
        <h2 id="workspace-title"></h2>
        <div id="top-controls">
            <!-- BOTÓN DE MENÚ PARA MÓVIL -->
            <button id="sidebar-toggle-btn" class="control-btn">☰</button>
            <span id="save-status"></span>
            <button id="show-general-btn" class="control-btn secondary">Ver Tablero General</button>
            <button id="addZoneBtn" class="control-btn">Añadir Zona</button>
            <button id="addNoteBtn" class="control-btn">Añadir Nota</button>
            <div id="user-profile-menu" class="profile-menu-container">
                <img id="profile-avatar" src="" alt="Avatar de Usuario" class="profile-avatar">
                <div class="profile-dropdown">
                    <div class="user-info">
                        <p id="user-name" class="user-name"></p>
                    </div>
                    <button id="signout-btn" class="signout-btn">
                        <span>🚪</span> Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>
        <div id="app">
            <div id="zonesContainer"></div>
            <div id="notesContainer"></div>
        </div>
        <!-- ESTE ES EL DASHBOARD INFERIOR ORIGINAL, SE OCULTARÁ EN MÓVIL -->
        <div id="bottom-dashboard">
            <div id="stats-widget" class="dashboard-widget"><h3>Notas</h3><span id="note-count">0</span></div>
            <div id="calendar-widget" class="dashboard-widget"><div class="calendar-header"><button id="prev-month"><</button><h3 id="month-year"></h3><button id="next-month">></button></div><div class="calendar-grid" id="calendar-days"></div></div>
            <div id="youtube-widget" class="dashboard-widget"><h3>Música de Fondo</h3><input type="text" id="youtube-url-input" placeholder="Pega link de YouTube"><div id="youtube-player"></div></div>
            <div id="timer-widget" class="dashboard-widget">
                <h3>Cronómetro</h3>
                <div class="timer-display-container">
                    <span id="timer-display">00:25:00</span>
                    <button id="edit-timer-btn" title="Configurar tiempo">✏️</button>
                </div>
                <div class="timer-buttons">
                    <button id="start-timer">▶</button>
                    <button id="stop-timer" class="hidden">❚❚</button>
                    <button id="reset-timer">⟲</button>
                </div>
            </div>
            <div id="clock-widget" class="dashboard-widget"><h3>Hora</h3><span id="current-time"></span><span id="current-date"></span></div>
        </div>
    </div>
    
    <!-- MODALES (sin cambios) -->
    <div id="alert-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h2 id="alert-modal-title"></h2>
            <p id="alert-modal-message"></p>
            <button id="alert-modal-close-btn" class="action-btn">Entendido</button>
        </div>
    </div>
    <div id="set-timer-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h2>Configurar Temporizador</h2>
            <p>Define la duración de tu temporizador.</p>
            <div class="set-timer-inputs">
                <input type="number" id="set-hours" min="0" max="99" placeholder="HH" oninput="this.value = this.value ? Math.min(99, Math.max(0, parseInt(this.value))) : ''">
                <input type="number" id="set-minutes" min="0" max="59" placeholder="MM" oninput="this.value = this.value ? Math.min(59, Math.max(0, parseInt(this.value))) : ''">
                <input type="number" id="set-seconds" min="0" max="59" placeholder="SS" oninput="this.value = this.value ? Math.min(59, Math.max(0, parseInt(this.value))) : ''">
            </div>
            <button id="save-timer-btn" class="action-btn">Guardar</button>
        </div>
    </div>
    <div id="confirm-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h2 id="confirm-modal-title"></h2>
            <p id="confirm-modal-message"></p>
            <div class="modal-actions">
                <button id="confirm-modal-cancel-btn" class="action-btn cancel-btn">Cancelar</button>
                <button id="confirm-modal-confirm-btn" class="action-btn confirm-btn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- NUEVA ESTRUCTURA HTML PARA EL MENÚ LATERAL MÓVIL -->
    <div id="mobile-sidebar-container">
        <div class="sidebar-overlay"></div>
        <aside id="mobile-sidebar">
            <div class="sidebar-header">
                <h3>Panel de Control</h3>
                <button id="close-sidebar-btn">×</button>
            </div>
            <div class="sidebar-content">
                <!-- Los widgets se clonan aquí mediante JavaScript para mantener su funcionalidad -->
            </div>
        </aside>
    </div>

<audio id="alarm-sound" src="audio/cat-meow-8-fx-306184.mp3"></audio>    

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCptS0stYpYu5GGLNXgtjNJD8NFzKZdEj0",
        authDomain: "mi-dashboard-de-notas.firebaseapp.com",
        projectId: "mi-dashboard-de-notas",
        storageBucket: "mi-dashboard-de-notas.appspot.com",
        messagingSenderId: "829232928135",
        appId: "1:829232cptS0stYpYu5GGLNXgtjNJD8NFzKZdEj0:web:04e2043af0d7f79d916f22",
        measurementId: "G-T89JSJ7DEN"
    };
    
    const App = {
        firebase: {},
        state: { /* ... (sin cambios) ... */ },
        DOM: {},
        
        init() {
            this.cacheDOM();
            this.initFirebase();
            this.setupMobileUI(); // Configurar UI móvil primero
            this.bindEvents();
            this.setupAllWidgets(); // Luego configurar widgets en ambos lugares
        },

        cacheDOM() {
            this.DOM.body = document.body;
            this.DOM.signInBtn = document.getElementById('google-signin-btn');
            this.DOM.notesContainer = document.getElementById('notesContainer');
            this.DOM.zonesContainer = document.getElementById('zonesContainer');
            this.DOM.workspaceTitle = document.getElementById('workspace-title');
            this.DOM.addNoteBtn = document.getElementById('addNoteBtn');
            this.DOM.addZoneBtn = document.getElementById('addZoneBtn');
            this.DOM.showGeneralBtn = document.getElementById('show-general-btn');
            this.DOM.saveStatus = document.getElementById('save-status');
            this.DOM.profileAvatar = document.getElementById('profile-avatar');
            this.DOM.userName = document.getElementById('user-name');
            this.DOM.signOutBtn = document.getElementById('signout-btn');
            this.DOM.alarmSound = document.getElementById('alarm-sound');
            
            // Contenedores de widgets
            this.DOM.bottomDashboard = document.getElementById('bottom-dashboard');
            
            // Modals
            this.DOM.alertModal = { overlay: document.getElementById('alert-modal-overlay'), title: document.getElementById('alert-modal-title'), message: document.getElementById('alert-modal-message'), closeBtn: document.getElementById('alert-modal-close-btn') };
            this.DOM.timerModal = { overlay: document.getElementById('set-timer-modal-overlay'), hoursInput: document.getElementById('set-hours'), minutesInput: document.getElementById('set-minutes'), secondsInput: document.getElementById('set-seconds'), saveBtn: document.getElementById('save-timer-btn') };
            this.DOM.confirmModal = { overlay: document.getElementById('confirm-modal-overlay'), title: document.getElementById('confirm-modal-title'), message: document.getElementById('confirm-modal-message'), confirmBtn: document.getElementById('confirm-modal-confirm-btn'), cancelBtn: document.getElementById('confirm-modal-cancel-btn') };

            // --- NUEVO: Elementos para la UI Móvil ---
            this.DOM.sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
            this.DOM.mobileSidebar = document.getElementById('mobile-sidebar');
            this.DOM.sidebarOverlay = document.querySelector('.sidebar-overlay');
            this.DOM.sidebarContent = document.querySelector('#mobile-sidebar .sidebar-content');
            this.DOM.closeSidebarBtn = document.getElementById('close-sidebar-btn');
        },

        // --- NUEVA FUNCIÓN PARA CONFIGURAR LA UI MÓVIL ---
        setupMobileUI() {
            // Clona los widgets del dashboard inferior a la barra lateral móvil.
            // Esto asegura que ambos (el original y el clon) existan en el DOM.
            const widgets = this.DOM.bottomDashboard.querySelectorAll('.dashboard-widget');
            widgets.forEach(widget => {
                const clone = widget.cloneNode(true);
                // Los IDs deben ser únicos. Eliminamos los IDs de los elementos clonados para evitar conflictos.
                clone.querySelectorAll('[id]').forEach(el => el.id = ''); 
                this.DOM.sidebarContent.appendChild(clone);
            });
        },

        initFirebase() { /* ... (sin cambios) ... */ },

        bindEvents() {
            this.DOM.signInBtn.addEventListener('click', () => signInWithPopup(this.firebase.auth, this.firebase.provider).catch(console.error));
            this.DOM.signOutBtn.addEventListener('click', () => signOut(this.firebase.auth));
            this.DOM.addNoteBtn.addEventListener('click', () => this.addNote());
            this.DOM.addZoneBtn.addEventListener('click', () => this.addZone());
            this.DOM.showGeneralBtn.addEventListener('click', () => {
                this.showGeneralDashboard();
                this.closeSidebar(); // Cierra el menú si está abierto
            });
            
            // --- NUEVO: Eventos para el menú lateral ---
            const toggleSidebar = () => this.DOM.body.classList.toggle('sidebar-active');
            this.DOM.sidebarToggleBtn.addEventListener('click', toggleSidebar);
            this.DOM.sidebarOverlay.addEventListener('click', toggleSidebar);
            this.DOM.closeSidebarBtn.addEventListener('click', toggleSidebar);

            // Modals
            this.DOM.alertModal.closeBtn.addEventListener('click', () => this.closeAlertModal());
            this.DOM.alertModal.overlay.addEventListener('click', e => { if (e.target === this.DOM.alertModal.overlay) this.closeAlertModal(); });
            this.DOM.timerModal.overlay.addEventListener('click', e => { if (e.target === this.DOM.timerModal.overlay) this.DOM.timerModal.overlay.classList.remove('visible'); });
            this.DOM.confirmModal.confirmBtn.addEventListener('click', () => this.handleConfirmAction());
            this.DOM.confirmModal.cancelBtn.addEventListener('click', () => this.closeConfirmModal());
            this.DOM.confirmModal.overlay.addEventListener('click', e => { if (e.target === this.DOM.confirmModal.overlay) this.closeConfirmModal(); });

            // Timer Events - Se aplicarán a AMBOS sets de botones (desktop y mobile)
            document.querySelectorAll('#start-timer, .sidebar-content #start-timer').forEach(btn => btn.addEventListener('click', () => this.requestConfirm('Iniciar Temporizador', '¿Estás seguro de que quieres iniciar el tiempo?', this.startTimer)));
            document.querySelectorAll('#stop-timer, .sidebar-content #stop-timer').forEach(btn => btn.addEventListener('click', () => this.requestConfirm('Pausar Temporizador', '¿Quieres pausar el tiempo?', this.stopTimer)));
            document.querySelectorAll('#reset-timer, .sidebar-content #reset-timer').forEach(btn => btn.addEventListener('click', () => this.requestConfirm('Reiniciar Temporizador', 'Esto restablecerá el tiempo a su valor inicial. ¿Continuar?', this.resetTimer)));
        },
        
        // --- GESTIÓN DE DATOS (sin cambios) ---
        requestConfirm(title, message, action) { /* ... */ },
        closeConfirmModal() { /* ... */ },
        handleConfirmAction() { /* ... */ },
        updateUserProfile(user) { /* ... */ },
        saveData: debounce(async function() { /* ... */ }, 1500),
        async loadData() { /* ... */ },
        renderWorkspace() {
            this.DOM.notesContainer.innerHTML = ''; 
            this.DOM.zonesContainer.innerHTML = '';
            const notesToShow = this.state.notes.filter(note => note.date === this.state.selectedDate);
            const zonesToShow = this.state.zones.filter(zone => zone.date === this.state.selectedDate);
            
            notesToShow.forEach(note => this.createNoteElement(note));
            zonesToShow.forEach(zone => this.createZoneElement(zone));
            
            if (this.state.selectedDate) {
                const [y, m, d] = this.state.selectedDate.split('-');
                this.DOM.workspaceTitle.textContent = `${new Date(y, m - 1, d).toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })}`;
            } else {
                this.DOM.workspaceTitle.textContent = 'Tablero General';
            }
            this.updateStats();
        },
        clearWorkspace() { /* ... */ },
        updateStats() {
            const notesInView = this.state.notes.filter(n => n.date === this.state.selectedDate).length;
            // Actualiza el contador en AMBOS lugares
            document.querySelectorAll('#note-count, .sidebar-content #note-count').forEach(el => el.textContent = notesInView);
        },
        makeDraggable(element, item) { /* ... (sin cambios, el CSS lo deshabilita en móvil) ... */ },
        makeResizable(element, item) { /* ... (sin cambios, el CSS lo deshabilita en móvil) ... */ },
        createNoteElement(note) { /* ... */ },
        createZoneElement(zone) { /* ... */ },
        addNote() { /* ... */ },
        addZone() { /* ... */ },
        showGeneralDashboard() { this.state.selectedDate = null; this.saveData(); this.renderWorkspace(); this.renderCalendar(); },
        
        closeSidebar() { this.DOM.body.classList.remove('sidebar-active'); },

        // --- LÓGICA DE WIDGETS ---
        setupAllWidgets() {
            // Llama a las funciones de setup pasándoles el contenedor raíz (document)
            // Esto asegura que los widgets originales se configuren
            this.setupClock(document);
            this.setupCalendar(document);
            this.setupYoutubePlayer(document);
            this.setupTimer(document);
            
            // Llama a las funciones de setup de nuevo, pero ahora para los widgets clonados en la sidebar
            // Pasamos el contenedor de la sidebar para limitar la búsqueda de elementos
            this.setupClock(this.DOM.mobileSidebar);
            this.setupCalendar(this.DOM.mobileSidebar);
            this.setupYoutubePlayer(this.DOM.mobileSidebar);
            this.setupTimer(this.DOM.mobileSidebar);
        },

        // Las funciones de setup ahora aceptan un `container` para buscar los elementos
        setupClock(container) {
            const timeEl = container.querySelector('#current-time');
            const dateEl = container.querySelector('#current-date');
            if (!timeEl || !dateEl) return;
            const updateClock = () => {
                const now = new Date();
                timeEl.textContent = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                dateEl.textContent = now.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' });
            };
            updateClock();
            setInterval(updateClock, 1000);
        },

        setupCalendar(container) {
            const prevBtn = container.querySelector('#prev-month');
            const nextBtn = container.querySelector('#next-month');
            const calendarDays = container.querySelector('#calendar-days');
            if (!prevBtn || !nextBtn || !calendarDays) return;

            prevBtn.onclick = () => { this.state.calendarDate.setMonth(this.state.calendarDate.getMonth() - 1); this.renderCalendar(); };
            nextBtn.onclick = () => { this.state.calendarDate.setMonth(this.state.calendarDate.getMonth() + 1); this.renderCalendar(); };
            calendarDays.addEventListener('click', e => {
                if (e.target.classList.contains('day') && e.target.dataset.date) {
                    this.state.selectedDate = e.target.dataset.date;
                    this.saveData();
                    this.renderWorkspace();
                    this.renderCalendar();
                    this.closeSidebar(); // Cierra el menú al seleccionar un día
                }
            });
            this.renderCalendar(); // Render inicial
        },

        renderCalendar() {
            // Esta función ahora debe actualizar AMBOS calendarios
            const containers = [document, this.DOM.mobileSidebar];
            containers.forEach(container => {
                const calendarDays = container.querySelector('#calendar-days');
                const monthYearEl = container.querySelector('#month-year');
                if (!calendarDays || !monthYearEl) return;

                calendarDays.innerHTML = '';
                const month = this.state.calendarDate.getMonth();
                const year = this.state.calendarDate.getFullYear();
                monthYearEl.textContent = new Date(year, month).toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
                const noteDates = new Set(this.state.notes.map(n => n.date).filter(Boolean));
                const firstDayIndex = (new Date(year, month, 1).getDay() + 6) % 7;
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();
                ['L', 'M', 'X', 'J', 'V', 'S', 'D'].forEach(day => calendarDays.innerHTML += `<span class="day-name">${day}</span>`);
                for (let i = 0; i < firstDayIndex; i++) calendarDays.innerHTML += `<span></span>`;
                for (let i = 1; i <= daysInMonth; i++) {
                    const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    let classes = 'day';
                    if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) classes += ' current-day';
                    if (dateString === this.state.selectedDate) classes += ' selected-day';
                    if (noteDates.has(dateString)) classes += ' has-notes';
                    calendarDays.innerHTML += `<span class="${classes}" data-date="${dateString}">${i}</span>`;
                }
            });
        },
        
        setupYoutubePlayer(container) {
            const input = container.querySelector('#youtube-url-input');
            const player = container.querySelector('#youtube-player');
            if (!input || !player) return;

            const loadVideo = (url) => {
                const videoId = (u => { const m = u.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/); return (m && m[2].length === 11) ? m[2] : null; })(url);
                if (videoId) {
                    player.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&loop=1&playlist=${videoId}&controls=0" frameborder="0" allow="autoplay"></iframe>`;
                    this.state.youtubeUrl = url;
                    this.saveData();
                }
            };
            input.addEventListener('change', e => loadVideo(e.target.value));
            if (this.state.youtubeUrl) { input.value = this.state.youtubeUrl; loadVideo(this.state.youtubeUrl); }
        },
        
        setupTimer(container) {
            const editBtn = container.querySelector('#edit-timer-btn');
            if (!editBtn) return;
            editBtn.addEventListener('click', () => this.showTimerModal());
            this.DOM.timerModal.saveBtn.addEventListener('click', () => this.saveTimerSettings());
            this.updateTimerDisplay();
        },

        updateTimerDisplay() {
            const h = String(Math.floor(this.state.timerSeconds / 3600)).padStart(2, '0');
            const m = String(Math.floor((this.state.timerSeconds % 3600) / 60)).padStart(2, '0');
            const s = String(this.state.timerSeconds % 60).padStart(2, '0');
            const timeString = `${h}:${m}:${s}`;
            document.querySelectorAll('#timer-display, .sidebar-content #timer-display').forEach(el => el.textContent = timeString);
        },

        startTimer() {
            if (this.state.timerInterval || this.state.timerSeconds <= 0) return;
            document.querySelectorAll('#timer-display, .sidebar-content #timer-display').forEach(el => { el.classList.add('timer-running'); el.classList.remove('timer-paused'); });
            document.querySelectorAll('#start-timer, .sidebar-content #start-timer').forEach(btn => btn.classList.add('hidden'));
            document.querySelectorAll('#stop-timer, .sidebar-content #stop-timer').forEach(btn => btn.classList.remove('hidden'));
            this.state.timerInterval = setInterval(() => {
                this.state.timerSeconds--;
                this.updateTimerDisplay();
                if (this.state.timerSeconds === 120 && !this.state.timerPreAlertShown) { this.showAlertModal('Recordatorio', 'Faltan 2 minutos para que termine tu actividad.'); this.state.timerPreAlertShown = true; }
                if (this.state.timerSeconds <= 0) { this.stopTimer(true); this.showAlertModal('¡Tiempo Cumplido!', 'Tu actividad programada ha finalizado.'); this.DOM.alarmSound.play(); }
            }, 1000);
        },
        stopTimer(isFinished = false) {
            clearInterval(this.state.timerInterval);
            this.state.timerInterval = null;
            document.querySelectorAll('#start-timer, .sidebar-content #start-timer').forEach(btn => btn.classList.remove('hidden'));
            document.querySelectorAll('#stop-timer, .sidebar-content #stop-timer').forEach(btn => btn.classList.add('hidden'));
            if (!isFinished) { document.querySelectorAll('#timer-display, .sidebar-content #timer-display').forEach(el => el.classList.add('timer-paused')); }
            document.querySelectorAll('#timer-display, .sidebar-content #timer-display').forEach(el => el.classList.remove('timer-running'));
        },
        resetTimer() {
            this.stopTimer(true);
            this.state.timerSeconds = this.state.timerInitialDuration;
            this.state.timerPreAlertShown = false;
            this.updateTimerDisplay();
            document.querySelectorAll('#timer-display, .sidebar-content #timer-display').forEach(el => el.classList.remove('timer-paused', 'timer-running'));
        },
        showTimerModal() { /* ... (sin cambios) ... */ },
        saveTimerSettings() { /* ... (sin cambios) ... */ },
        showAlertModal(title, message) { /* ... */ },
        closeAlertModal() { /* ... */ }
    };

    function debounce(func, wait) { let timeout; return function executedFunction(...args) { const later = () => { clearTimeout(timeout); func.apply(this, args); }; clearTimeout(timeout); timeout = setTimeout(later, wait); }; }
    document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>